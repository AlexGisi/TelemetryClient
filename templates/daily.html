<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>KU Solar Car Telemetry</title>
		<link rel="stylesheet" type="text/css" href="static/style.css">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<script src="static/Moment.js"></script>
		<script src="static/Chart.js"></script>
		<style type="text/css">
			html, body { height: 100%; }
			body {
				display: flex;
				flex-flow: column;
				margin: 0;
			}
			#date-changer {
				margin: 8px 0 8px 0;
			}
			#date-changer input, #date-changer button {
				font-size: 16pt;
			}
			#date-changer form {
				display: inline-block;
				margin: 0;
			}
			#tabs {
				z-index: 100;
			}
			.tab {
				display: inline-block;
				background: #ddd;
				border: 1px solid black;
				border-radius: 4px 4px 0 0;
				padding: 4px;
				font-family: sans-serif;
				font-size: 16pt;
				min-width: 5em;
				margin-bottom: -1.5px; /* Makes bottom of tab overlap with graph container */
				cursor: pointer;
			}
			.tab.active {
				background: white;
				font-weight: bold;
				border-bottom-color: white;
				border-width: 2px;
				padding: 3px;
			}
			#graph-container {
				flex: 1;
				padding: 0 8px 8px 8px;
			}
			.graph {
				display: none;
				width: 100%;
				height: 100%;
				background: white;
				border: 1px solid black;
				border-radius: 4px;
			}
		</style>
		<script type="text/javascript">
			const TABS = [{% for graph, data in graph_data.items() %}'{{graph}}', {% endfor %}];
			function setTab(tab) {
				for (var i = 0; i < TABS.length; i++) {
					var isActiveTab = (TABS[i] == tab);
					document.getElementById("tab-"+TABS[i]).classList.toggle("active", isActiveTab);
					document.getElementById(TABS[i]).style.display = isActiveTab ? "block" : "none";
				}
			}
		</script>
	</head>
	<body>
		<div id="bg"></div>
		<div id="date-changer">
			<form method="GET"><button type="submit" name="date" value="{{prev_date_str}}">&#9668;</button></form>
			<form method="GET"><input type="date" name="date" value="{{date_str}}" oninput="this.form.submit()"></form>
			<form><button type="submit" name="date" value="{{next_date_str}}">&#9658;</button></form>
		</div>
		<div id="tabs">
			{% for graph, data in graph_data.items() %}
				<span class="tab" id="tab-{{graph}}" onclick="setTab('{{graph}}')">{{graph}}</span>
			{% endfor %}
		</div>
		<div id="graph-container">
			{% for graph, data in graph_data.items() %}
				<div class="graph" id="{{graph}}"> 
					<!-- ¯\_(ツ)_/¯ -->
					<canvas id="chart-{{graph}}"></canvas>
					<script type="text/javascript">
						new Chart(document.getElementById('chart-{{graph}}').getContext('2d'), {
							type: "scatter",
							data: {
								datasets: [
									{% for sensor, entries in data.items() %}
										{
											label: "{{sensor}}",
											data: [
												{% for time, entry in entries.items() %}
													{x: {{time}}, y: {{entry}}},
												{% endfor %}
											], fill: false, borderColor: "red", borderWidth: 2.5, showLine: true
										},
									{% endfor %}
								]
							},
							options: {
								maintainAspectRatio: false,
								tooltips: {mode: "index", intersect: false},
								hover: {mode: "index", intersect: false},
								scales: {
									xAxes: [{
										type: "time",
										scaleLabel: {display: true, labelString: "Hour"}, 
										time: {unit: "hour"},										
									}],
									yAxes: [{
										//ticks: {beginAtZero: true}
									}]
								}
							}
						});
					</script>
				</div>
			{% endfor %}
		</div>
	</body>
</html>